{% extends "twigs/template.twig" %}

{% block content %}
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-xl-10 col-lg-11">
				<div class="page-header d-flex justify-content-between align-items-center">
					<h1>Products</h1>
					{% if user.is_admin %}
						<div class="btn-group" role="group" aria-label="Produt actions">
							<button class="btn btn-primary d-flex" data-toggle="modal" data-target="#add-product-form">Add Product</button>
							<button class="btn btn-secondary d-flex" data-toggle="modal" data-target="#validate-idml-form">Validate IDML</button>
						</div>
					{% endif %}
				</div>
				<hr>
				<div class="content-list">
					<form id="product-filter-form" method="post" action="/products">
						<input type="hidden" id="product-filter-page" name="page" value="1"></input>
						<div class="row">
							<div class="col-md-6 box">
								<div class="form-group row align-items-center">
									<label for="product-filter-title" class="col-sm-4 col">Original Title</label>
									<select id="product-filter-title" class="col-sm selectize" name="title" data-placeholder="Type or select from the list ...">
										<option value=""></option>
										{% for item in title_options %}
											<option {% if item.name == filter.title %}selected{% endif %}>{{ item.name }}</option>
										{% endfor %}
									</select>
								</div>
								{% if title_options|length == 0 %}
									<div class="form-group row align-items-center">
										<span class="col-4"></span>
										<span class="col small">Original Titles list is empty</span>
									</div>
								{% endif %}
								<div class="form-group row align-items-center">
									<label for="product-filter-available-in" class="col-4">Available In</label>
									<select id="product-filter-available-in" class="col selectize" name="available_in" data-placeholder="Type or select from the list ...">
										<option value=""></option>
										{% for item in available_in_options %}
											<option {% if item.id == filter.available_in %}selected{% endif %} value="{{ item.id }}">{{ item.name }}</option>
										{% endfor %}
									</select>
								</div>
								{% if available_in_options|length == 0 %}
									<div class="form-group row align-items-center">
										<span class="col-4"></span>
										<span class="col small">Available In list is empty</span>
									</div>
								{% endif %}
								<div class="form-group row align-items-center">
									<label for="product-filter-audience" class="col-4">Audience</label>
									<select id="product-filter-audience" class="col selectize" name="audience" data-placeholder="Type or select from the list ...">
										<option value=""></option>
										{% for item in audience_options %}
											<option {% if item.id == filter.audience %}selected{% endif %} value="{{ item.id }}">{{ item.name }}</option>
										{% endfor %}
									</select>
								</div>
							</div>
							<div class="col-md-6 box">
								<div class="form-group row align-items-center">
									<label for="product-filter-author" class="col-4">Author</label>
									<select id="product-filter-author" class="col selectize" name="author" data-placeholder="Type or select from the list ...">
										<option value=""></option>
										{% for item in author_options %}
											<option {% if item.author == filter.author %}selected{% endif %} value="{{ item.author }}">{{ item.author }}</option>
										{% endfor %}
									</select>
								</div>
								{% if author_options|length == 0 %}
									<div class="form-group row align-items-center">
										<span class="col-4"></span>
										<span class="col small">Authors list is empty</span>
									</div>
								{% endif %}
								<div class="form-group row align-items-center">
									<label for="product-filter-type" class="col-4">Type</label>
									<select id="product-filter-type" class="col selectize" name="type" data-placeholder="Type or select from the list ...">
										<option value=""></option>
										{% for item in product_types %}
											<option {% if item == filter.type %}selected{% endif %} value="{{ item }}">{{ item }}</option>
										{% endfor %}
									</select>
								</div>
								<div class="form-group row align-items-center">
									<label for="product-filter-binding" class="col-4">Binding</label>
									<select id="product-filter-binding" class="col selectize" name="binding" data-placeholder="Type or select from the list ...">
										<option value=""></option>
										{% for item in product_bindings %}
											<option {% if item.id == filter.binding %}selected{% endif %} value="{{ item.id }}">{{ item.name }}</option>
										{% endfor %}
									</select>
								</div>
							</div>
							<div class="col-md-8">
								<div class="form-group row align-items-center h-100">
									<label class="col-3">Sort By</label>
									<div class="col custom-control custom-radio products-sort-by">
										<input type="radio" id="sort-by-title" name="sort_by" class="custom-control-input" value="title" {% if filter.sort_by is not defined or 'title' == filter.sort_by %}checked{% endif %}>
										<label class="custom-control-label" for="sort-by-title">Title</label>
									</div>
									<div class="col custom-control custom-radio">
										<input type="radio" id="sort-by-author" name="sort_by" class="custom-control-input" value="author" {% if filter.sort_by is defined and 'author' == filter.sort_by %}checked{% endif %}>
										<label class="custom-control-label" for="sort-by-author">Author</label>
									</div>
									<div class="col custom-control custom-radio">
										<input type="radio" id="sort-by-publisher" name="sort_by" class="custom-control-input" value="publisher" {% if filter.sort_by is defined and 'publisher' == filter.sort_by %}checked{% endif %}>
										<label class="custom-control-label" for="sort-by-publisher">Publisher</label>
									</div>
								</div>
							</div>
							<div class="col-md-4 d-flex justify-content-end">
								<button class="btn btn-primary reset" type="button">
									View All
								</button>&nbsp;
								<button class="btn btn-primary" type="submit">
									Search
								</button>
							</div>
						</div>
					</form>
					<hr>
					<div class="content-list-body row">
						{% for product in products  %}
							<div class="col-md-6">
								<div class="card card-project">
									<div class="row no-gutters">
										<div class="col" style="flex: 0 0 120px">
											<img src="/uploads/{{ product.cover_image }}" height="180" class="rounded-left">
										</div>
										<div class="col">
											<div class="card-body">
												<div class="card-title">
													<a href="/products/{{ product.id }}">
														<h5 data-filter-by="text">{{ product.name }}</h5>
													</a>
												</div>
												<div class="card-meta d-flex justify-content-between">
													<div class="">
														<span class="text-small">Author: {{ product.author }}</span><br>
														<span class="text-small">Pages: {{ product.page_count }} </span><br>
														<span class="text-small">Languages:  {{ product.languages }} </span><br>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						{% endfor %}
					</div>
					<nav>
						<ul class="pagination justify-content-end">
							{{ links | raw}}
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</div>
	{% if user.is_admin %}
		{% include 'twigs/modals/_product_add.twig' %}
		{% include 'twigs/modals/_idml_validation.twig' %}
	{% endif %}
{% endblock %}

{% block javascripts %}
	<script src="{{ '/assets/js/page/products.js' }}"></script>
{% endblock %}  
